/* guidance-emoji.c
 *
 * Copyright 2021 Michael Gran
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "guidance-emoji.h"

#ifdef GUIDANCE_EMOJI_TEST
#include <locale.h>
#endif

static const gunichar emoji[256] = {
  0x231A, 0x23E9, 0x23F0, 0x23F3, 0x25FD, 0x2614, 0x2648, 0x267F,
  0x2693, 0x26A1, 0x26AA, 0x26BD, 0x26C4, 0x26CE, 0x26D4, 0x26EA,
  0x26F2, 0x26F5, 0x26FA, 0x26FD, 0x2705, 0x270A, 0x2728, 0x274C,
  0x274E, 0x2753, 0x2757, 0x2795, 0x27B0, 0x27BF, 0x2B1B, 0x2B50,
  0x2B55, 0x1F004, 0x1F0CF, 0x1F18E, 0x1F191, 0x1F201, 0x1F21A,
  0x1F22F, 0x1F232, 0x1F238, 0x1F250, 0x1F300, 0x1F30D, 0x1F30F,
  0x1F310, 0x1F311, 0x1F312, 0x1F313, 0x1F316, 0x1F319, 0x1F31A,
  0x1F31B, 0x1F31C, 0x1F31D, 0x1F31F, 0x1F32D, 0x1F330, 0x1F332,
  0x1F334, 0x1F337, 0x1F34B, 0x1F34C, 0x1F350, 0x1F351, 0x1F37C,
  0x1F37E, 0x1F380, 0x1F3A0, 0x1F3C5, 0x1F3C6, 0x1F3C7, 0x1F3C8,
  0x1F3C9, 0x1F3CA, 0x1F3CF, 0x1F3E0, 0x1F3E4, 0x1F3E5, 0x1F3F4,
  0x1F3F8, 0x1F408, 0x1F409, 0x1F40C, 0x1F40F, 0x1F411, 0x1F413,
  0x1F414, 0x1F415, 0x1F416, 0x1F417, 0x1F42A, 0x1F42B, 0x1F440,
  0x1F442, 0x1F465, 0x1F466, 0x1F46C, 0x1F46E, 0x1F4AD, 0x1F4AE,
  0x1F4B6, 0x1F4B8, 0x1F4EC, 0x1F4EE, 0x1F4EF, 0x1F4F0, 0x1F4F5,
  0x1F4F6, 0x1F4F8, 0x1F4F9, 0x1F4FF, 0x1F503, 0x1F504, 0x1F508,
  0x1F509, 0x1F50A, 0x1F515, 0x1F516, 0x1F52C, 0x1F52E, 0x1F54B,
  0x1F550, 0x1F55C, 0x1F57A, 0x1F595, 0x1F5A4, 0x1F5FB, 0x1F600,
  0x1F601, 0x1F607, 0x1F609, 0x1F60E, 0x1F60F, 0x1F610, 0x1F611,
  0x1F612, 0x1F615, 0x1F616, 0x1F617, 0x1F618, 0x1F619, 0x1F61A,
  0x1F61B, 0x1F61C, 0x1F61F, 0x1F620, 0x1F626, 0x1F628, 0x1F62C,
  0x1F62D, 0x1F62E, 0x1F630, 0x1F634, 0x1F635, 0x1F636, 0x1F637,
  0x1F641, 0x1F645, 0x1F680, 0x1F681, 0x1F683, 0x1F686, 0x1F687,
  0x1F688, 0x1F689, 0x1F68A, 0x1F68C, 0x1F68D, 0x1F68E, 0x1F68F,
  0x1F690, 0x1F691, 0x1F694, 0x1F695, 0x1F696, 0x1F697, 0x1F698,
  0x1F699, 0x1F69B, 0x1F6A2, 0x1F6A3, 0x1F6A4, 0x1F6A6, 0x1F6A7,
  0x1F6AE, 0x1F6B2, 0x1F6B3, 0x1F6B6, 0x1F6B7, 0x1F6B9, 0x1F6BF,
  0x1F6C0, 0x1F6C1, 0x1F6CC, 0x1F6D0, 0x1F6D1, 0x1F6D5, 0x1F6D6,
  0x1F6EB, 0x1F6F4, 0x1F6F7, 0x1F6F9, 0x1F6FA, 0x1F6FB, 0x1F7E0,
  0x1F90C, 0x1F90D, 0x1F910, 0x1F919, 0x1F91F, 0x1F920, 0x1F928,
  0x1F930, 0x1F931, 0x1F933, 0x1F93C, 0x1F93F, 0x1F940, 0x1F947,
  0x1F94C, 0x1F94D, 0x1F950, 0x1F95F, 0x1F96C, 0x1F971, 0x1F972,
  0x1F973, 0x1F977, 0x1F97A, 0x1F97B, 0x1F97C, 0x1F980, 0x1F985,
  0x1F992, 0x1F998, 0x1F9A3, 0x1F9A5, 0x1F9AB, 0x1F9AE, 0x1F9B0,
  0x1F9BA, 0x1F9C0, 0x1F9C1, 0x1F9C3, 0x1F9CB, 0x1F9CD, 0x1F9D0,
  0x1F9E7, 0x1FA70, 0x1FA74, 0x1FA78, 0x1FA80, 0x1FA83, 0x1FA90
};

/* Returns a newly allocated string containing a single
 * emoji character. */
char *
gdn_string_hash_to_emoji (const char *str)
{
  guint    hash;
  gunichar c;
  char     outbuf[6];

  memset (outbuf, 0, 6);
  hash = g_str_hash (str);
  c = emoji[hash & 0xFFu];
  g_unichar_to_utf8 (c, outbuf);
  return g_strdup (outbuf);
}

/* Returns a newly allocated string containing a single
 * emoji character. */
char *
gdn_integer_hash_to_emoji (gint64 x)
{
  guint    hash = 0;
  gunichar c;
  char     outbuf[6];

  memset (outbuf, 0, 6);
  hash = g_direct_hash ((gconstpointer) x);
  c = emoji[hash & 0xFFu];
  g_unichar_to_utf8 (c, outbuf);
  return g_strdup (outbuf);
}

#ifdef GUIDANCE_EMOJI_TEST
int
main ()
{
  char  str[2] = "";
  char *emoji;

  setlocale (LC_ALL, "");
  for (int i = 0; i < 256; i++)
    {
      emoji = gdn_integer_hash_to_emoji (i);
      printf ("%d %s\n", g_direct_hash (i), emoji);
      free (emoji);
    }
  for (int i = 32; i < 127; i++)
    {
      str[0] = i;
      emoji = gdn_string_hash_to_emoji (str);
      printf ("%d %s\n", g_str_hash (str), emoji);
      free (emoji);
    }
  return 0;
}
#endif
